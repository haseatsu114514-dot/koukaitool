<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Age2Birth | 年齢×誕生日 逆算ツール</title>
  <meta name="description" content="年齢と誕生日（月日）だけで生年月日を素早く逆算する、公開向けシンプルツール。">
  <style>
    :root {
      --bg1: #f3f8ff;
      --bg2: #f8fbf6;
      --card: #ffffff;
      --line: #d7e2ee;
      --text: #132235;
      --muted: #58718a;
      --brand: #0a62c8;
      --brand-deep: #084a95;
      --accent: #e8f2ff;
      --ok: #0f7a46;
      --danger: #ad1f35;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: "Hiragino Sans", "Yu Gothic", sans-serif;
      background:
        radial-gradient(circle at 6% 8%, #dff1ff 0%, transparent 38%),
        radial-gradient(circle at 88% 12%, #e8ffe8 0%, transparent 34%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
    }

    main {
      max-width: 920px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      display: grid;
      gap: 14px;
    }

    .hero {
      background: linear-gradient(130deg, #0f3b72, #1457a3);
      color: #f4f9ff;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 14px 30px rgba(16, 50, 90, 0.18);
    }

    .hero h1 {
      margin: 0;
      font-size: 1.85rem;
      letter-spacing: 0.01em;
    }

    .hero p {
      margin: 8px 0 0;
      color: rgba(244, 249, 255, 0.88);
      line-height: 1.55;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 8px 22px rgba(22, 50, 83, 0.06);
    }

    .panel h2 {
      margin: 0 0 10px;
      font-size: 1.08rem;
    }

    #todayText {
      margin: 0;
      color: var(--muted);
      font-size: 0.93rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 10px;
      align-items: end;
    }

    label {
      display: block;
      color: var(--muted);
      font-size: 0.88rem;
      margin-bottom: 4px;
    }

    input, select {
      width: 100%;
      border: 1px solid #c4d4e4;
      border-radius: 9px;
      padding: 8px 10px;
      font-size: 1rem;
      background: #fff;
      color: var(--text);
    }

    .birthday-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    button {
      border: none;
      border-radius: 9px;
      padding: 9px 13px;
      cursor: pointer;
      font-size: 0.94rem;
    }

    #calcBtn {
      background: var(--brand);
      color: #fff;
    }

    #calcBtn:hover {
      background: var(--brand-deep);
    }

    #clearBtn,
    #copyBtn {
      border: 1px solid #cad8e5;
      background: #eef4fa;
      color: var(--text);
    }

    .result {
      margin-top: 12px;
      border-radius: 10px;
      background: var(--accent);
      padding: 12px;
      min-height: 48px;
      line-height: 1.55;
    }

    .result.error {
      background: #ffecef;
      color: var(--danger);
    }

    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: var(--muted);
      min-height: 1.2em;
    }

    .status.ok {
      color: var(--ok);
    }

    .provider-panel {
      border: none;
      padding: 0;
      overflow: hidden;
    }

    .provider-banner {
      position: relative;
      display: block;
      text-decoration: none;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #0f2a49;
      box-shadow: 0 12px 24px rgba(12, 38, 68, 0.25);
    }

    .provider-banner img {
      display: block;
      width: 100%;
      height: 182px;
      object-fit: cover;
      object-position: center;
      transition: transform 0.25s ease;
    }

    .provider-banner:hover img {
      transform: scale(1.02);
    }

    .provider-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        92deg,
        rgba(7, 16, 31, 0.72) 0%,
        rgba(7, 16, 31, 0.58) 46%,
        rgba(7, 16, 31, 0.34) 72%,
        rgba(7, 16, 31, 0.22) 100%
      );
    }

    .provider-content {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
      padding: 16px 18px;
      color: #f8fbff;
      z-index: 1;
    }

    .provider-label {
      font-size: 0.8rem;
      letter-spacing: 0.05em;
      color: rgba(248, 251, 255, 0.82);
    }

    .provider-title {
      font-family: "Yu Mincho", "Hiragino Mincho ProN", serif;
      font-size: 1.7rem;
      font-weight: 700;
      letter-spacing: 0.01em;
      line-height: 1.15;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
    }

    .provider-sub {
      font-size: 0.85rem;
      color: rgba(248, 251, 255, 0.9);
    }
  </style>
</head>
<body>
  <main>
    <section class="hero">
      <h1>Age2Birth</h1>
      <p>占い相談で「年齢」と「誕生日（月日）」だけ分かる相手の生年月日を、すぐ逆算できる公開版ツールです。</p>
    </section>

    <section class="panel">
      <h2>年齢×誕生日 逆算</h2>
      <p id="todayText"></p>

      <div class="form-grid">
        <div>
          <label for="ageInput">今の年齢</label>
          <input id="ageInput" type="number" min="0" max="130" placeholder="例: 28">
        </div>

        <div>
          <label>誕生日（月 / 日）</label>
          <div class="birthday-row">
            <input id="monthInput" type="number" min="1" max="12" placeholder="月">
            <input id="dayInput" type="number" min="1" max="31" placeholder="日">
          </div>
        </div>

        <div>
          <label for="leapRuleInput">平年の2/29扱い</label>
          <select id="leapRuleInput">
            <option value="feb28">2/28として判定</option>
            <option value="mar1">3/1として判定</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button id="calcBtn" type="button">生年月日を逆算する</button>
        <button id="copyBtn" type="button">結果をコピー</button>
        <button id="clearBtn" type="button">入力クリア</button>
      </div>

      <div id="resultBox" class="result">未計算</div>
      <p id="statusText" class="status"></p>
    </section>

    <section class="panel provider-panel">
      <a
        class="provider-banner"
        href="https://uranai-rokkon.com/"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img src="assets/rokkon-provider.jpg" alt="占い処 六根清浄">
        <span class="provider-overlay"></span>
        <span class="provider-content">
          <span class="provider-label">提供元</span>
          <span class="provider-title">占い処 六根清浄</span>
          <span class="provider-sub">https://uranai-rokkon.com/</span>
        </span>
      </a>
    </section>
  </main>

  <script>
    const ageInput = document.getElementById("ageInput");
    const monthInput = document.getElementById("monthInput");
    const dayInput = document.getElementById("dayInput");
    const leapRuleInput = document.getElementById("leapRuleInput");
    const todayText = document.getElementById("todayText");
    const resultBox = document.getElementById("resultBox");
    const statusText = document.getElementById("statusText");

    let latestResultText = "";
    let currentDateKey = "";

    refreshCurrentDate(true);

    document.getElementById("calcBtn").addEventListener("click", calculateBirthDate);
    document.getElementById("copyBtn").addEventListener("click", copyResult);
    document.getElementById("clearBtn").addEventListener("click", clearInputs);
    window.addEventListener("focus", () => {
      refreshCurrentDate(false);
    });
    setInterval(() => {
      refreshCurrentDate(false);
    }, 60000);

    function calculateBirthDate() {
      const today = refreshCurrentDate(false);
      const age = Number(ageInput.value.trim());
      const month = Number(monthInput.value.trim());
      const day = Number(dayInput.value.trim());
      const leapMode = leapRuleInput.value;

      if (!Number.isInteger(age) || age < 0 || age > 130) {
        setResultError("年齢を0〜130で入力してください。");
        return;
      }

      if (!isValidMonthDayInput(month, day)) {
        setResultError("誕生日（月/日）が正しくありません。");
        return;
      }

      const birthYear = findBirthYear(age, month, day, today, leapMode);
      if (birthYear == null) {
        setResultError("入力条件から生年月日を確定できません。");
        return;
      }

      const birthDateText = formatDate(birthYear, month, day);
      const leapNote =
        month === 2 && day === 29
          ? "（平年扱い: " + (leapMode === "mar1" ? "3/1" : "2/28") + "）"
          : "";
      const text = "推定生年月日: " + birthDateText + (leapNote ? " " + leapNote : "");

      resultBox.textContent = text;
      resultBox.classList.remove("error");
      latestResultText = text;
      setStatus("逆算しました。", true);
    }

    function findBirthYear(age, birthMonth, birthDay, today, leapMode) {
      const base = today.year - age;
      const candidates = [base - 1, base, base + 1];

      for (let i = 0; i < candidates.length; i += 1) {
        const year = candidates[i];
        if (!isRealBirthDate(year, birthMonth, birthDay)) {
          continue;
        }
        const calculatedAge = calculateAgeAtToday(year, birthMonth, birthDay, today, leapMode);
        if (calculatedAge === age) {
          return year;
        }
      }
      return null;
    }

    function calculateAgeAtToday(birthYear, birthMonth, birthDay, today, leapMode) {
      let age = today.year - birthYear;
      const anniversary = anniversaryInYear(today.year, birthMonth, birthDay, leapMode);
      const beforeBirthday =
        today.month < anniversary.month ||
        (today.month === anniversary.month && today.day < anniversary.day);
      if (beforeBirthday) {
        age -= 1;
      }
      return age;
    }

    function anniversaryInYear(year, birthMonth, birthDay, leapMode) {
      if (birthMonth === 2 && birthDay === 29 && !isLeapYear(year)) {
        if (leapMode === "mar1") {
          return { month: 3, day: 1 };
        }
        return { month: 2, day: 28 };
      }
      return { month: birthMonth, day: birthDay };
    }

    function isValidMonthDayInput(month, day) {
      if (!Number.isInteger(month) || !Number.isInteger(day)) {
        return false;
      }
      if (month < 1 || month > 12 || day < 1) {
        return false;
      }
      return isRealBirthDate(2000, month, day);
    }

    function isRealBirthDate(year, month, day) {
      const date = new Date(year, month - 1, day);
      return (
        date.getFullYear() === year &&
        date.getMonth() === month - 1 &&
        date.getDate() === day
      );
    }

    function isLeapYear(year) {
      if (year % 400 === 0) {
        return true;
      }
      if (year % 100 === 0) {
        return false;
      }
      return year % 4 === 0;
    }

    function getCurrentDateParts() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth() + 1;
      const day = now.getDate();
      return {
        year: year,
        month: month,
        day: day,
        dateKey: formatDate(year, month, day)
      };
    }

    function refreshCurrentDate(force) {
      const current = getCurrentDateParts();
      if (force || current.dateKey !== currentDateKey) {
        currentDateKey = current.dateKey;
        todayText.textContent = "基準日: " + current.dateKey;
      }
      return current;
    }

    function clearInputs() {
      ageInput.value = "";
      monthInput.value = "";
      dayInput.value = "";
      leapRuleInput.value = "feb28";
      resultBox.textContent = "未計算";
      resultBox.classList.remove("error");
      latestResultText = "";
      setStatus("", false);
    }

    function setResultError(message) {
      resultBox.textContent = message;
      resultBox.classList.add("error");
      latestResultText = "";
      setStatus("", false);
    }

    function setStatus(message, success) {
      statusText.textContent = message;
      statusText.classList.toggle("ok", Boolean(success));
    }

    async function copyResult() {
      if (!latestResultText) {
        setStatus("コピーできる結果がありません。", false);
        return;
      }
      try {
        await navigator.clipboard.writeText(latestResultText);
        setStatus("結果をコピーしました。", true);
      } catch (error) {
        setStatus("コピーに失敗しました。", false);
      }
    }

    function formatDate(year, month, day) {
      return (
        String(year).padStart(4, "0") +
        "-" +
        String(month).padStart(2, "0") +
        "-" +
        String(day).padStart(2, "0")
      );
    }
  </script>
</body>
</html>
