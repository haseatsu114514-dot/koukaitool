<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>生年月日逆算くん | 年齢×誕生日で逆算</title>
  <meta name="description" content="年齢と誕生日（月日）だけで生年月日を逆算。占い相談向けの公開ツール（2人対応）。">
  <style>
    :root {
      --bg1: #f3f8ff;
      --bg2: #f8fbf6;
      --card: #ffffff;
      --line: #d7e2ee;
      --text: #132235;
      --muted: #58718a;
      --brand: #0a62c8;
      --brand-deep: #084a95;
      --accent: #e8f2ff;
      --ok: #0f7a46;
      --danger: #ad1f35;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: "Hiragino Sans", "Yu Gothic", sans-serif;
      background:
        radial-gradient(circle at 6% 8%, #dff1ff 0%, transparent 38%),
        radial-gradient(circle at 88% 12%, #e8ffe8 0%, transparent 34%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
    }

    main {
      max-width: 980px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      display: grid;
      gap: 14px;
    }

    .hero {
      background: linear-gradient(130deg, #0f3b72, #1457a3);
      color: #f4f9ff;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 14px 30px rgba(16, 50, 90, 0.18);
    }

    .hero h1 {
      margin: 0;
      font-size: 1.85rem;
      letter-spacing: 0.01em;
    }

    .hero p {
      margin: 8px 0 0;
      color: rgba(244, 249, 255, 0.88);
      line-height: 1.55;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 8px 22px rgba(22, 50, 83, 0.06);
    }

    .panel h2 {
      margin: 0 0 10px;
      font-size: 1.08rem;
    }

    #todayText {
      margin: 0;
      color: var(--muted);
      font-size: 0.93rem;
    }

    label {
      display: block;
      color: var(--muted);
      font-size: 0.88rem;
      margin-bottom: 4px;
    }

    input {
      width: 100%;
      border: 1px solid #c4d4e4;
      border-radius: 9px;
      padding: 8px 10px;
      font-size: 1rem;
      background: #fff;
      color: var(--text);
    }

    .people-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .person-card {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      background: #fbfdff;
    }

    .person-card h3 {
      margin: 0 0 8px;
      font-size: 1rem;
    }

    .birthday-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .person-result {
      margin-top: 6px;
      border-radius: 8px;
      background: var(--accent);
      min-height: 38px;
      padding: 8px 10px;
      line-height: 1.45;
      font-size: 0.9rem;
      white-space: pre-line;
    }

    .person-result.error {
      background: #ffecef;
      color: var(--danger);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    button {
      border: none;
      border-radius: 9px;
      padding: 9px 13px;
      cursor: pointer;
      font-size: 0.94rem;
    }

    #calcBtn {
      background: var(--brand);
      color: #fff;
    }

    #calcBtn:hover {
      background: var(--brand-deep);
    }

    #clearBtn,
    #copyBtn {
      border: 1px solid #cad8e5;
      background: #eef4fa;
      color: var(--text);
    }

    .summary-result {
      margin-top: 12px;
      border-radius: 10px;
      background: var(--accent);
      padding: 12px;
      min-height: 48px;
      line-height: 1.55;
      white-space: pre-line;
    }

    .summary-result.error {
      background: #ffecef;
      color: var(--danger);
    }

    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: var(--muted);
      min-height: 1.2em;
    }

    .status.ok {
      color: var(--ok);
    }

    .provider-panel {
      border: none;
      padding: 0;
      overflow: hidden;
    }

    .provider-banner {
      position: relative;
      display: block;
      text-decoration: none;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #0f2a49;
      box-shadow: 0 12px 24px rgba(12, 38, 68, 0.25);
    }

    .provider-banner img {
      display: block;
      width: 100%;
      height: 182px;
      object-fit: cover;
      object-position: center;
      transition: transform 0.25s ease;
    }

    .provider-banner:hover img {
      transform: scale(1.02);
    }

    .provider-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        92deg,
        rgba(7, 16, 31, 0.72) 0%,
        rgba(7, 16, 31, 0.58) 46%,
        rgba(7, 16, 31, 0.34) 72%,
        rgba(7, 16, 31, 0.22) 100%
      );
    }

    .provider-content {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
      padding: 16px 18px;
      color: #f8fbff;
      z-index: 1;
    }

    .provider-label {
      font-size: 0.8rem;
      letter-spacing: 0.05em;
      color: rgba(248, 251, 255, 0.82);
    }

    .provider-title {
      font-family: "Yu Mincho", "Hiragino Mincho ProN", serif;
      font-size: 1.7rem;
      font-weight: 700;
      letter-spacing: 0.01em;
      line-height: 1.15;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.35);
    }

    .provider-sub {
      font-size: 0.85rem;
      color: rgba(248, 251, 255, 0.9);
    }
  </style>
</head>
<body>
  <main>
    <section class="panel provider-panel">
      <a
        class="provider-banner"
        href="https://uranai-rokkon.com/"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img src="assets/rokkon-provider.jpg" alt="占い処 六根清浄">
        <span class="provider-overlay"></span>
        <span class="provider-content">
          <span class="provider-label">提供元</span>
          <span class="provider-title">占い処 六根清浄</span>
          <span class="provider-sub">https://uranai-rokkon.com/</span>
        </span>
      </a>
    </section>

    <section class="hero">
      <h1>生年月日逆算くん</h1>
      <p>占い相談で「年齢」と「誕生日（月日）」だけ分かる相手の生年月日を、2人分まとめて逆算できます。</p>
    </section>

    <section class="panel">
      <h2>年齢×誕生日 逆算（2人まで）</h2>
      <p id="todayText"></p>

      <div class="people-grid">
        <article class="person-card">
          <h3>1人目</h3>
          <label for="name1">名前（任意）</label>
          <input id="name1" type="text" placeholder="例: 相談相手A">

          <label for="age1">今の年齢</label>
          <input id="age1" type="number" min="0" max="130" placeholder="例: 28">

          <label>誕生日（月 / 日）</label>
          <div class="birthday-row">
            <input id="month1" type="number" min="1" max="12" placeholder="月">
            <input id="day1" type="number" min="1" max="31" placeholder="日">
          </div>

          <div id="personResult1" class="person-result">未計算</div>
        </article>

        <article class="person-card">
          <h3>2人目</h3>
          <label for="name2">名前（任意）</label>
          <input id="name2" type="text" placeholder="例: 相談相手B">

          <label for="age2">今の年齢</label>
          <input id="age2" type="number" min="0" max="130" placeholder="例: 35">

          <label>誕生日（月 / 日）</label>
          <div class="birthday-row">
            <input id="month2" type="number" min="1" max="12" placeholder="月">
            <input id="day2" type="number" min="1" max="31" placeholder="日">
          </div>

          <div id="personResult2" class="person-result">未計算</div>
        </article>
      </div>

      <div class="actions">
        <button id="calcBtn" type="button">生年月日を逆算する</button>
        <button id="copyBtn" type="button">結果をコピー</button>
        <button id="clearBtn" type="button">入力クリア</button>
      </div>

      <div id="summaryResult" class="summary-result">未計算</div>
      <p id="statusText" class="status"></p>
    </section>
  </main>

  <script>
    const MAX_PEOPLE = 2;

    const todayText = document.getElementById("todayText");
    const summaryResult = document.getElementById("summaryResult");
    const statusText = document.getElementById("statusText");

    let latestResultText = "";
    let currentDateKey = "";

    refreshCurrentDate(true);

    document.getElementById("calcBtn").addEventListener("click", calculateBirthDate);
    document.getElementById("copyBtn").addEventListener("click", copyResult);
    document.getElementById("clearBtn").addEventListener("click", clearInputs);

    window.addEventListener("focus", () => {
      refreshCurrentDate(false);
    });
    setInterval(() => {
      refreshCurrentDate(false);
    }, 60000);

    function calculateBirthDate() {
      const today = refreshCurrentDate(false);
      const summaryLines = [];
      let hasAnyInput = false;
      let successCount = 0;

      for (let i = 1; i <= MAX_PEOPLE; i += 1) {
        const name = getValue("name" + i);
        const ageRaw = getValue("age" + i);
        const monthRaw = getValue("month" + i);
        const dayRaw = getValue("day" + i);
        const cardResult = document.getElementById("personResult" + i);

        if (!name && !ageRaw && !monthRaw && !dayRaw) {
          cardResult.textContent = "未入力";
          cardResult.classList.remove("error");
          continue;
        }

        hasAnyInput = true;

        if (!ageRaw || !monthRaw || !dayRaw) {
          setCardError(cardResult, "年齢と誕生日（月/日）をすべて入力してください。");
          continue;
        }

        const age = Number(ageRaw);
        const month = Number(monthRaw);
        const day = Number(dayRaw);

        if (!Number.isInteger(age) || age < 0 || age > 130) {
          setCardError(cardResult, "年齢を0〜130で入力してください。");
          continue;
        }

        if (!isValidMonthDayInput(month, day)) {
          setCardError(cardResult, "誕生日（月/日）が正しくありません。");
          continue;
        }

        const resolved = resolveBirthDate(age, month, day, today);
        if (!resolved.success) {
          setCardError(cardResult, "入力条件から生年月日を確定できません。");
          continue;
        }

        const label = name || i + "人目";
        const personText = label + ": " + resolved.text;
        cardResult.textContent = personText;
        cardResult.classList.remove("error");
        summaryLines.push(personText);
        successCount += 1;
      }

      if (!hasAnyInput) {
        setSummaryError("1人以上入力してください。");
        return;
      }

      if (successCount === 0) {
        setSummaryError("入力エラーがあります。各欄を確認してください。");
        return;
      }

      const summaryText = summaryLines.join("\n");
      summaryResult.textContent = summaryText;
      summaryResult.classList.remove("error");
      latestResultText = summaryText;
      setStatus("逆算しました。", true);
    }

    function resolveBirthDate(age, birthMonth, birthDay, today) {
      if (birthMonth !== 2 || birthDay !== 29) {
        const year = findBirthYear(age, birthMonth, birthDay, today, "feb28");
        if (year == null) {
          return { success: false };
        }
        return { success: true, text: formatDate(year, birthMonth, birthDay) };
      }

      const yearFeb = findBirthYear(age, 2, 29, today, "feb28");
      const yearMar = findBirthYear(age, 2, 29, today, "mar1");

      if (yearFeb == null && yearMar == null) {
        return { success: false };
      }

      if (yearFeb != null && yearMar != null) {
        if (yearFeb === yearMar) {
          return { success: true, text: formatDate(yearFeb, 2, 29) + "（2/29生まれ対応）" };
        }
        return {
          success: true,
          text:
            "候補: " +
            formatDate(yearFeb, 2, 29) +
            "（2/28基準） / " +
            formatDate(yearMar, 2, 29) +
            "（3/1基準）"
        };
      }

      if (yearFeb != null) {
        return { success: true, text: formatDate(yearFeb, 2, 29) + "（2/28基準）" };
      }

      return { success: true, text: formatDate(yearMar, 2, 29) + "（3/1基準）" };
    }

    function findBirthYear(age, birthMonth, birthDay, today, leapMode) {
      const base = today.year - age;
      const candidates = [];
      for (let delta = -2; delta <= 2; delta += 1) {
        candidates.push(base + delta);
      }

      for (let i = 0; i < candidates.length; i += 1) {
        const year = candidates[i];
        if (!isRealBirthDate(year, birthMonth, birthDay)) {
          continue;
        }
        const calculatedAge = calculateAgeAtToday(year, birthMonth, birthDay, today, leapMode);
        if (calculatedAge === age) {
          return year;
        }
      }
      return null;
    }

    function calculateAgeAtToday(birthYear, birthMonth, birthDay, today, leapMode) {
      let age = today.year - birthYear;
      const anniversary = anniversaryInYear(today.year, birthMonth, birthDay, leapMode);
      const beforeBirthday =
        today.month < anniversary.month ||
        (today.month === anniversary.month && today.day < anniversary.day);
      if (beforeBirthday) {
        age -= 1;
      }
      return age;
    }

    function anniversaryInYear(year, birthMonth, birthDay, leapMode) {
      if (birthMonth === 2 && birthDay === 29 && !isLeapYear(year)) {
        if (leapMode === "mar1") {
          return { month: 3, day: 1 };
        }
        return { month: 2, day: 28 };
      }
      return { month: birthMonth, day: birthDay };
    }

    function isValidMonthDayInput(month, day) {
      if (!Number.isInteger(month) || !Number.isInteger(day)) {
        return false;
      }
      if (month < 1 || month > 12 || day < 1) {
        return false;
      }
      return isRealBirthDate(2000, month, day);
    }

    function isRealBirthDate(year, month, day) {
      const date = new Date(year, month - 1, day);
      return (
        date.getFullYear() === year &&
        date.getMonth() === month - 1 &&
        date.getDate() === day
      );
    }

    function isLeapYear(year) {
      if (year % 400 === 0) {
        return true;
      }
      if (year % 100 === 0) {
        return false;
      }
      return year % 4 === 0;
    }

    function getCurrentDateParts() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth() + 1;
      const day = now.getDate();
      return {
        year: year,
        month: month,
        day: day,
        dateKey: formatDate(year, month, day)
      };
    }

    function refreshCurrentDate(force) {
      const current = getCurrentDateParts();
      if (force || current.dateKey !== currentDateKey) {
        currentDateKey = current.dateKey;
        todayText.textContent = "基準日: " + current.dateKey;
      }
      return current;
    }

    function clearInputs() {
      for (let i = 1; i <= MAX_PEOPLE; i += 1) {
        document.getElementById("name" + i).value = "";
        document.getElementById("age" + i).value = "";
        document.getElementById("month" + i).value = "";
        document.getElementById("day" + i).value = "";
        const cardResult = document.getElementById("personResult" + i);
        cardResult.textContent = "未計算";
        cardResult.classList.remove("error");
      }

      summaryResult.textContent = "未計算";
      summaryResult.classList.remove("error");
      latestResultText = "";
      setStatus("", false);
    }

    function setCardError(element, message) {
      element.textContent = message;
      element.classList.add("error");
    }

    function setSummaryError(message) {
      summaryResult.textContent = message;
      summaryResult.classList.add("error");
      latestResultText = "";
      setStatus("", false);
    }

    function setStatus(message, success) {
      statusText.textContent = message;
      statusText.classList.toggle("ok", Boolean(success));
    }

    async function copyResult() {
      if (!latestResultText) {
        setStatus("コピーできる結果がありません。", false);
        return;
      }
      try {
        await navigator.clipboard.writeText(latestResultText);
        setStatus("結果をコピーしました。", true);
      } catch (error) {
        setStatus("コピーに失敗しました。", false);
      }
    }

    function getValue(id) {
      return document.getElementById(id).value.trim();
    }

    function formatDate(year, month, day) {
      return (
        String(year).padStart(4, "0") +
        "-" +
        String(month).padStart(2, "0") +
        "-" +
        String(day).padStart(2, "0")
      );
    }
  </script>
</body>
</html>
